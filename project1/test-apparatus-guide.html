<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdFlow Test Apparatus — User Guide</title>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,500;0,600;1,400&family=IBM+Plex+Serif:wght@400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --ink: #1a1a2e;
            --ink-soft: #4a4a6a;
            --ink-faint: #8888aa;
            --rule: #e0e0ee;
            --bg: #fafafa;
            --code-bg: #f0f0f8;
            --accent: #1a4fa0;
            --accent-lt: #e8eef9;
            --gold: #b07d20;
            --gold-lt: #fdf6e3;
            --green: #1a6b3a;
            --green-lt: #eaf5ee;
            --red: #9b1c1c;
            --red-lt: #fef2f2;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 15px;
            line-height: 1.75;
            color: var(--ink);
            background: var(--bg);
            max-width: 860px;
            margin: 0 auto;
            padding: 60px 48px 120px;
        }

        .doc-header {
            border-bottom: 3px solid var(--ink);
            padding-bottom: 28px;
            margin-bottom: 52px;
        }

        .doc-meta {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            letter-spacing: .08em;
            text-transform: uppercase;
            color: var(--ink-faint);
            margin-bottom: 12px;
        }

        h1.doc-title {
            font-family: 'IBM Plex Serif', serif;
            font-size: 34px;
            font-weight: 600;
            line-height: 1.2;
            color: var(--ink);
            margin-bottom: 10px;
        }

        .doc-sub {
            font-size: 14px;
            color: var(--ink-soft);
        }

        h2.part {
            font-family: 'IBM Plex Serif', serif;
            font-size: 22px;
            font-weight: 600;
            color: var(--ink);
            margin: 52px 0 18px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--ink);
            display: flex;
            align-items: baseline;
            gap: 12px;
        }

        h2.part .part-num {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            letter-spacing: .1em;
            text-transform: uppercase;
            color: var(--ink-faint);
            font-weight: 400;
        }

        h3.section {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 16px;
            font-weight: 600;
            color: var(--accent);
            margin: 28px 0 10px;
        }

        h4.subsection {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
            margin: 22px 0 8px;
            letter-spacing: .02em;
        }

        p {
            margin-bottom: 14px;
        }

        p:last-child {
            margin-bottom: 0;
        }

        .callout {
            border-left: 4px solid var(--accent);
            background: var(--accent-lt);
            padding: 16px 20px;
            margin: 24px 0;
            border-radius: 0 6px 6px 0;
        }

        .callout.gold {
            border-color: var(--gold);
            background: var(--gold-lt);
        }

        .callout.green {
            border-color: var(--green);
            background: var(--green-lt);
        }

        .callout.red {
            border-color: var(--red);
            background: var(--red-lt);
        }

        .callout-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 10px;
            letter-spacing: .1em;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--ink-soft);
        }

        .callout p {
            font-size: 14px;
        }

        .callout ol,
        .callout ul {
            font-size: 14px;
            margin: 8px 0 0 22px;
        }

        .callout li {
            margin-bottom: 5px;
        }

        .step {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: flex-start;
        }

        .step-num {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: var(--accent);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            margin-top: 2px;
        }

        .step-body {
            flex: 1;
        }

        .step-body h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--ink);
        }

        .step-body p,
        .step-body ul,
        .step-body ol {
            font-size: 14px;
        }

        .step-body ul,
        .step-body ol {
            margin: 6px 0 0 20px;
        }

        .step-body li {
            margin-bottom: 5px;
        }

        .table-wrap {
            overflow-x: auto;
            margin: 18px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13.5px;
        }

        thead th {
            background: var(--ink);
            color: #fff;
            font-weight: 600;
            font-family: 'IBM Plex Sans', sans-serif;
            text-align: left;
            padding: 10px 14px;
        }

        tbody tr:nth-child(even) {
            background: #f4f4f8;
        }

        tbody td {
            padding: 9px 14px;
            border-bottom: 1px solid var(--rule);
            vertical-align: top;
        }

        tbody td:first-child {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            color: var(--accent);
        }

        pre {
            background: var(--code-bg);
            border: 1px solid var(--rule);
            border-radius: 6px;
            padding: 18px 22px;
            margin: 14px 0;
            overflow-x: auto;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12.5px;
            line-height: 1.65;
            color: var(--ink);
        }

        code {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12.5px;
            background: var(--code-bg);
            padding: 1px 5px;
            border-radius: 3px;
        }

        ul,
        ol {
            margin: 10px 0 14px 24px;
        }

        li {
            margin-bottom: 6px;
        }

        .doc-footer {
            margin-top: 72px;
            padding-top: 20px;
            border-top: 1px solid var(--rule);
            font-size: 13px;
            color: var(--ink-soft);
        }

        @media print {
            body {
                padding: 40px;
                font-size: 13px;
            }
        }
    </style>
</head>

<body>

    <header class="doc-header">
        <div class="doc-meta">Project 1 &nbsp;·&nbsp; AdFlow &nbsp;·&nbsp; Distributed Systems for Data Science</div>
        <h1 class="doc-title">Test Apparatus — User Guide</h1>
        <div class="doc-sub">How to use the browser-based load generator and results viewer to test your deployed Lambda
            pipeline.</div>
    </header>


    <!-- ══════════════════════════════════════════════════════════════════
     WHAT IS IT
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Overview</span> What Is the Test Apparatus?</h2>

    <p>The test apparatus is a single HTML file (<code>test-apparatus/index.html</code>) that runs entirely in your
        browser — no server, no Python process, no installation. It generates realistic ad opportunity messages using a
        seeded random number generator, sends them directly to your deployed SQS input queue, polls your results queue
        as your Lambda responds, and displays live metrics and a scrolling results table.</p>

    <p>Everything happens between your browser and AWS. The AWS SDK v2 is loaded from a CDN, and your credentials are
        held only in the browser tab's memory — they are not stored anywhere unless you click Save Config, which writes
        only to your browser's local storage.</p>

    <div class="callout red">
        <div class="callout-label">Prerequisites — complete these first</div>
        <ol>
            <li>Implement all four functions in <code>worker/lambda_handler.py</code></li>
            <li>Pass all unit tests: <code>pytest worker/tests/ -v</code></li>
            <li>Deploy your stack: <code>sam build &amp;&amp; sam deploy --guided --stack-name adflow-YOURID</code></li>
            <li>Have your AWS Access Key ID and Secret Access Key ready from the Learner Lab</li>
        </ol>
    </div>


    <!-- ══════════════════════════════════════════════════════════════════
     OPENING
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Step 1</span> Open the Tool</h2>

    <p>Double-click <code>test-apparatus/index.html</code> in your project folder. It opens in any modern browser
        (Chrome, Firefox, Edge). There is no server or terminal command to run first.</p>

    <div class="callout green">
        <div class="callout-label">Note</div>
        <p>If your browser blocks the AWS SDK script due to a CORS policy on <code>file://</code> URLs, open the file
            via a local HTTP server instead: <code>python -m http.server 8000</code> from the
            <code>test-apparatus/</code> directory, then visit <code>http://localhost:8000</code>.</p>
    </div>


    <!-- ══════════════════════════════════════════════════════════════════
     CREDENTIALS
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Step 2</span> Enter Your AWS Credentials</h2>

    <p>The green card at the top of the page asks for your AWS credentials. Fill in all three fields:</p>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Field</th>
                    <th>What to Enter</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Access Key ID</td>
                    <td>Starts with <code>AKIA…</code> — copy from the AWS Learner Lab credentials page</td>
                </tr>
                <tr>
                    <td>Secret Access Key</td>
                    <td>The long secret string from the same credentials page (displayed as dots for privacy)</td>
                </tr>
                <tr>
                    <td>AWS Region</td>
                    <td>Select <code>us-east-1</code> — must match the region you deployed to</td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Click <strong>Test Connection</strong>. The badge turns green and reads "Connected" when your credentials are
        valid. If it shows "Failed," refresh your Learner Lab session and copy fresh keys — lab sessions expire after a
        few hours.</p>

    <p>Click <strong>Save Config</strong> to persist your credentials and student ID to <code>localStorage</code> so
        they reload automatically next time you open the file.</p>


    <!-- ══════════════════════════════════════════════════════════════════
     CONFIGURATION
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Step 3</span> Enter Your Student ID</h2>

    <p>In the blue Configuration card, type your student ID — lowercase, matching the ID you used when running
        <code>sam deploy</code>. The tool auto-generates all resource references from your ID:</p>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Auto-Generated Field</th>
                    <th>Value (example: id = gsalu)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Input Queue</td>
                    <td>adflow-gsalu-input</td>
                </tr>
                <tr>
                    <td>Results Queue</td>
                    <td>adflow-gsalu-results</td>
                </tr>
                <tr>
                    <td>DynamoDB Table</td>
                    <td>adflow-gsalu-results</td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>The tool resolves these names to full SQS URLs automatically when you run a test. Leave the <strong>Random
            Seed</strong> at 42 unless you want a different message set — the same seed always produces the same
        opportunity sequence, which makes results reproducible across runs.</p>


    <!-- ══════════════════════════════════════════════════════════════════
     PROFILES
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Step 4</span> Choose a Test Profile</h2>

    <p>Test profiles control how many messages are generated and how quickly they are sent to your input queue. Start
        small and work up.</p>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Profile</th>
                    <th>Messages</th>
                    <th>Delay</th>
                    <th>When to Use</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Warmup</td>
                    <td>10</td>
                    <td>500 ms</td>
                    <td>First test after deploying. Verifies your pipeline works end-to-end.</td>
                </tr>
                <tr>
                    <td>Steady</td>
                    <td>100</td>
                    <td>100 ms</td>
                    <td>Moderate load. Good for validating correctness across many messages.</td>
                </tr>
                <tr>
                    <td>Burst</td>
                    <td>500</td>
                    <td>0 ms</td>
                    <td>All messages at once. Use this profile for the analysis report data.</td>
                </tr>
                <tr>
                    <td>Ramp</td>
                    <td>500</td>
                    <td>Variable</td>
                    <td>Starts slow, accelerates. Useful for observing Lambda scaling behavior.</td>
                </tr>
                <tr>
                    <td>Soak</td>
                    <td>200</td>
                    <td>1,000 ms</td>
                    <td>Sustained trickle. Useful for observing steady-state latency.</td>
                </tr>
                <tr>
                    <td>Custom</td>
                    <td>Your choice</td>
                    <td>Your choice</td>
                    <td>Set your own message count and batch delay.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="callout gold">
        <div class="callout-label">Recommended Workflow</div>
        <ol>
            <li>Run <strong>Warmup</strong> (10 messages). Wait until all 10 results appear in the table.</li>
            <li>Click <strong>Full Cleanup</strong> in the yellow Cleanup section before the next run.</li>
            <li>Run <strong>Burst</strong> (500 messages, seed 42) to collect the data for your analysis report.</li>
            <li>Use the same seed each time so your results are reproducible.</li>
        </ol>
    </div>


    <!-- ══════════════════════════════════════════════════════════════════
     RUNNING
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Step 5</span> Run the Test</h2>

    <p>Click <strong>Run Test</strong>. Here is what happens behind the scenes:</p>

    <div class="step">
        <div class="step-num">1</div>
        <div class="step-body">
            <h4>Messages are generated locally</h4>
            <p>The browser generates the full set of ad opportunity messages using the seeded random number generator —
                the same algorithm as <code>simulator/generator.py</code>. No network call is needed for this step.</p>
        </div>
    </div>

    <div class="step">
        <div class="step-num">2</div>
        <div class="step-body">
            <h4>Messages are sent to SQS in batches of 10</h4>
            <p>The SQS <code>SendMessageBatch</code> API accepts up to 10 messages per call. The tool respects this
                limit and sends all messages before polling begins.</p>
        </div>
    </div>

    <div class="step">
        <div class="step-num">3</div>
        <div class="step-body">
            <h4>Polling begins on the results queue</h4>
            <p>The tool polls your results queue every 2 seconds. As your Lambda processes batches from the input queue
                and posts results, they appear here in near-real time.</p>
        </div>
    </div>

    <div class="step">
        <div class="step-num">4</div>
        <div class="step-body">
            <h4>Live metrics and results table update</h4>
            <p>Sent, Received, Avg Latency, and Results/sec all update as messages arrive. The progress bar fills as
                Received approaches Sent. The results table shows each won auction — winner, bid amount, score, margin,
                and processed timestamp.</p>
        </div>
    </div>

    <h3 class="section">Control Buttons</h3>
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Button</th>
                    <th>What It Does</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Run Test</td>
                    <td>Generates messages, sends them to SQS, and starts polling for results.</td>
                </tr>
                <tr>
                    <td>Stop</td>
                    <td>Stops sending and polling. Messages already in the queue will still be processed by Lambda.</td>
                </tr>
                <tr>
                    <td>Poll Results Only</td>
                    <td>Does not send any new messages — only polls the results queue. Use this to pick up stragglers
                        from a test you stopped early.</td>
                </tr>
            </tbody>
        </table>
    </div>


    <!-- ══════════════════════════════════════════════════════════════════
     INTERPRETING RESULTS
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Reading</span> Interpreting the Results</h2>

    <h3 class="section">Live Metrics</h3>
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Meaning</th>
                    <th>What to Expect</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sent</td>
                    <td>Messages successfully sent to the input queue</td>
                    <td>Should match your chosen message count</td>
                </tr>
                <tr>
                    <td>Received</td>
                    <td>Result messages retrieved from the results queue</td>
                    <td>Should eventually equal Sent. If it stays at 0, your Lambda may have an error.</td>
                </tr>
                <tr>
                    <td>Avg Latency (ms)</td>
                    <td>Average time from when the test started to when each result was polled back</td>
                    <td>Includes Lambda cold start. The first batch is always slower.</td>
                </tr>
                <tr>
                    <td>Results/sec</td>
                    <td>How fast results are arriving, measured from the start of the test</td>
                    <td>Increases as Lambda scales up concurrent executions to handle burst load</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3 class="section">Results Table — Column Definitions</h3>
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Column</th>
                    <th>Meaning</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Opportunity ID</td>
                    <td>First 8 characters of the UUID. Matches the message you sent.</td>
                </tr>
                <tr>
                    <td>Winner</td>
                    <td>The <code>winning_advertiser_id</code> your scoring function selected — the bid with the highest
                        quality-adjusted score, not necessarily the highest raw bid.</td>
                </tr>
                <tr>
                    <td>Bid ($)</td>
                    <td>The raw bid amount of the winning advertiser (USD CPM).</td>
                </tr>
                <tr>
                    <td>Score</td>
                    <td>The quality-adjusted score: <code>bid × relevance × time_bonus × device_bonus</code>.</td>
                </tr>
                <tr>
                    <td>Margin</td>
                    <td>Winning score minus second-place score. A small margin means the auction was competitive.</td>
                </tr>
                <tr>
                    <td>Latency</td>
                    <td>Time in milliseconds between message send and result receipt (approximate, includes queue and
                        Lambda processing time).</td>
                </tr>
                <tr>
                    <td>Processed At</td>
                    <td>The UTC timestamp your Lambda stamped on the result — when it finished processing the message.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3 class="section">DynamoDB Table Viewer</h3>
    <p>Click <strong>Scan Table</strong> in the DynamoDB section to read all records directly from your results table.
        This view includes additional fields not shown in the live results table: content category, region, device, and
        number of bids per opportunity. Use this to verify that DynamoDB writes are working and to inspect the data
        before running your analysis notebook.</p>


    <!-- ══════════════════════════════════════════════════════════════════
     CLEANUP
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Cleanup</span> Resetting Between Test Runs</h2>

    <p>The yellow Cleanup section at the bottom resets your environment. Leftover messages from a previous run will mix
        with new ones, and duplicate records in DynamoDB will silently overwrite each other — always clean up before
        starting a fresh test.</p>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Button</th>
                    <th>What It Does</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Purge Input Queue</td>
                    <td>Removes all messages from the input queue. SQS enforces a 60-second cooldown between purges on
                        the same queue.</td>
                </tr>
                <tr>
                    <td>Purge Results Queue</td>
                    <td>Removes all messages from the results queue.</td>
                </tr>
                <tr>
                    <td>Recreate DynamoDB Table</td>
                    <td>Deletes and recreates the table (takes 30–60 seconds). This is the only efficient way to clear
                        all items without scanning and deleting one by one.</td>
                </tr>
                <tr>
                    <td>Full Cleanup (All)</td>
                    <td>Runs all three operations sequentially and resets the live metrics display. Use this before any
                        fresh test run.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>The same operations are available from the command line via <code>python cleanup.py --student-id YOURID</code> if
        you prefer the terminal.</p>


    <!-- ══════════════════════════════════════════════════════════════════
     ACTIVITY LOG
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Logs</span> Activity Log</h2>

    <p>The dark terminal area at the bottom of the page shows timestamped entries for every action the tool performs —
        sends, receives, errors, and cleanup operations. If something goes wrong, look here first. AWS error codes
        appear verbatim so you can search for them in the documentation.</p>


    <!-- ══════════════════════════════════════════════════════════════════
     TROUBLESHOOTING
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Troubleshooting</span> Common Problems</h2>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Symptom</th>
                    <th>Likely Cause</th>
                    <th>Fix</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Test Connection fails</td>
                    <td>Expired or incorrect credentials</td>
                    <td>Refresh your Learner Lab session and copy fresh keys</td>
                </tr>
                <tr>
                    <td>ERROR resolving queue URLs</td>
                    <td>Stack not deployed, or student ID mismatch</td>
                    <td>Run <code>sam deploy --guided</code> and verify your student ID matches</td>
                </tr>
                <tr>
                    <td>Sent goes up but Received stays at 0</td>
                    <td>Lambda is crashing or throwing on every message</td>
                    <td>Check CloudWatch: <code>aws logs tail /aws/lambda/adflow-YOURID-worker --follow</code></td>
                </tr>
                <tr>
                    <td>Received is less than Sent after several minutes</td>
                    <td>Some messages caused errors — SQS is retrying them</td>
                    <td>Check logs for ERROR entries. Click "Poll Results Only" to collect stragglers once errors are
                        fixed.</td>
                </tr>
                <tr>
                    <td>Results show wrong winner or score</td>
                    <td>Bug in <code>compute_score</code> or <code>select_winner</code></td>
                    <td>Run unit tests locally. Compare output against the worked example in the assignment document.
                    </td>
                </tr>
                <tr>
                    <td>DynamoDB Scan Table returns 0 items</td>
                    <td>DynamoDB write failing silently, or <code>process_opportunity</code> not reaching the put_item
                        call</td>
                    <td>Check CloudWatch for exceptions. Confirm you are converting floats to
                        <code>Decimal(str(value))</code> before writing.</td>
                </tr>
            </tbody>
        </table>
    </div>


    <!-- ══════════════════════════════════════════════════════════════════
     COST
══════════════════════════════════════════════════════════════════ -->
    <h2 class="part"><span class="part-num">Cost</span> AWS Free Tier Safety</h2>

    <div class="callout gold">
        <div class="callout-label">Cost Reminder</div>
        <ul>
            <li><strong>SQS:</strong> First 1 million requests per month are free. A 500-message Burst test uses roughly
                100 API calls total.</li>
            <li><strong>Lambda:</strong> First 1 million invocations per month are free. 500 messages = roughly 50
                Lambda invocations at batch size 10.</li>
            <li><strong>DynamoDB:</strong> On-demand pricing is negligible for 500 writes.</li>
            <li>When you are done with the project, tear down all resources:
                <code>sam delete --stack-name adflow-YOURID</code></li>
        </ul>
    </div>


    <footer class="doc-footer">
        Test Apparatus Guide &nbsp;·&nbsp; Project 1: AdFlow &nbsp;·&nbsp; Distributed Systems for Data Science
        &nbsp;·&nbsp; New College of Florida
    </footer>

</body>

</html>